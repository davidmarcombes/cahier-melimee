/* Theme toggle */
function themeToggle(){return{dark:document.documentElement.classList.contains('dark'),toggle(){this.dark=!this.dark;document.documentElement.classList.toggle('dark',this.dark);localStorage.setItem('theme',this.dark?'dark':'light')}}}

/* Series player — single-template engine */
function seriesPlayer(exercises){return{exercises,currentIndex:0,userInput:'',showError:false,solvedFlags:exercises.map(()=>false),init(){this.syncFromHash()},get cur(){return this.exercises[this.currentIndex]||{}},get solved(){return this.solvedFlags[this.currentIndex]},get solvedCount(){return this.solvedFlags.filter(Boolean).length},get allSolved(){return this.solvedFlags.every(Boolean)},check(){if(this.solved||!this.userInput.trim())return;if(this.userInput.trim().toLowerCase()===this.cur.answer){this.solvedFlags[this.currentIndex]=true;this.showError=false;if(this.currentIndex<this.exercises.length-1){setTimeout(()=>this.goTo(this.currentIndex+1),1500)}}else{this.showError=true;setTimeout(()=>{this.showError=false},2000)}},goTo(idx){this.currentIndex=idx;this.userInput='';this.showError=false;window.location.hash='#'+(idx+1);this.$nextTick(()=>{const ref=this.$refs.input;if(ref&&!ref.disabled)ref.focus()})},syncFromHash(){const h=parseInt(window.location.hash.replace('#',''),10);if(h>=1&&h<=this.exercises.length){this.currentIndex=h-1}}}}

/* Series browser — listing page filter */
function seriesBrowser(allSeries){const unique=(key)=>[...new Set(allSeries.map(s=>s[key]).filter(Boolean))].sort();return{allSeries,filters:{level:'',topic:'',subtopic:'',difficulty:''},options:{level:unique('level'),topic:unique('topic'),difficulty:unique('difficulty')},get subtopicOptions(){const pool=this.filters.topic?this.allSeries.filter(s=>s.topic===this.filters.topic):this.allSeries;return[...new Set(pool.map(s=>s.subtopic).filter(Boolean))].sort()},get filtered(){return this.allSeries.filter(s=>(!this.filters.level||s.level===this.filters.level)&&(!this.filters.topic||s.topic===this.filters.topic)&&(!this.filters.subtopic||s.subtopic===this.filters.subtopic)&&(!this.filters.difficulty||s.difficulty===this.filters.difficulty))},get hasActiveFilter(){return Object.values(this.filters).some(v=>v!=='')},resetFilters(){this.filters={level:'',topic:'',subtopic:'',difficulty:''}}}}
