<!doctype html>
<html lang="{{ lang or 'en' }}" class="antialiased">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ title or site.title }}</title>
  <meta name="description" content="{{ description or site.description }}" />

  <!-- Favicons & social images (replace with your own in src/assets/images/) -->
  <link rel="icon" href="/assets/images/favicon.png" />
  <link rel="apple-touch-icon" href="/assets/images/favicon.png" />
  <meta name="theme-color" content="#ffffff">

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="{{ title or site.title }}" />
  <meta property="og:description" content="{{ description or site.description }}" />
  <meta property="og:image" content="{{ site.url }}/assets/images/share-image.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="{{ site.url }}/assets/images/share-image.jpg" />

  <!-- Fonts -->

    <link rel="stylesheet" href="/css/styles.css">
    <style>
      [x-cloak] { display: none !important; }
    </style>
    <script>
      (function() {
        var stored = localStorage.getItem('theme');
        if (stored === 'dark' || (!stored && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>
  <body class="min-h-screen flex flex-col bg-surface-default text-content-default">
    {% include "components/header.njk" %}

    <main class="flex-1 max-w-6xl mx-auto px-4 py-8 w-full">
      {{ content | safe }}
    </main>

    {% include "components/footer.njk" %}

    <!-- Demo mode indicator — shown when PocketBase is unavailable -->
    <div id="demo-banner" style="display:none"
      class="fixed bottom-4 right-4 px-3 py-1.5 text-xs font-bold rounded-full bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300 border border-amber-300 dark:border-amber-700 shadow-sm z-50">
      Mode démo
    </div>

    <script defer src="/assets/js/app.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- PocketBase SDK -->
    <script src="https://unpkg.com/pocketbase@latest/dist/pocketbase.umd.js"></script>
    <script>
      // Global PocketBase availability check — resolves to true/false.
      // Components await this to decide between live and demo mode.
      window.__pbAvailable = (async function() {
        try {
          const c = new AbortController();
          setTimeout(() => c.abort(), 2000);
          const r = await fetch('http://localhost:8090/api/health', { signal: c.signal });
          return r.ok;
        } catch { return false; }
      })();
      window.__pbAvailable.then(ok => {
        if (!ok) { const b = document.getElementById('demo-banner'); if (b) b.style.display = ''; }
      });
    </script>
  </body>
</html>
