---
layout: base
---

{% set seriesList = collections.exercices | groupBySeries | withDefis(collections.defis) %}

<div x-data='seriesBrowser({{ seriesList | seriesListPayload | safe }})' x-cloak class="py-4">
  <h1 class="text-3xl font-extrabold text-content-default mb-6">{{ title }}</h1>

  {{ content | safe }}

  <!-- Filters -->
  <div class="flex flex-wrap gap-3 mb-8">
    <select x-model="filters.level" class="px-3 py-2 text-sm rounded-lg border border-slate-200 dark:border-slate-700 bg-surface-subtle text-content-default">
      <option value="">Tous les niveaux</option>
      <template x-for="v in options.level" :key="v">
        <option :value="v" x-text="v"></option>
      </template>
    </select>

    <select x-model="filters.topic" @change="filters.subtopic = ''" class="px-3 py-2 text-sm rounded-lg border border-slate-200 dark:border-slate-700 bg-surface-subtle text-content-default">
      <option value="">Toutes les mati√®res</option>
      <template x-for="v in options.topic" :key="v">
        <option :value="v" x-text="v"></option>
      </template>
    </select>

    <select x-model="filters.subtopic" x-show="subtopicOptions.length > 0" class="px-3 py-2 text-sm rounded-lg border border-slate-200 dark:border-slate-700 bg-surface-subtle text-content-default">
      <option value="">Tous les th√®mes</option>
      <template x-for="v in subtopicOptions" :key="v">
        <option :value="v" x-text="v"></option>
      </template>
    </select>

    <select x-model="filters.difficulty" class="px-3 py-2 text-sm rounded-lg border border-slate-200 dark:border-slate-700 bg-surface-subtle text-content-default">
      <option value="">Difficult√©</option>
      <template x-for="v in options.difficulty" :key="v">
        <option :value="v" x-text="(v === 'difficile' ? 'üêû ' : v === 'moyen' ? 'üêù ' : 'ü¶ó ') + v"></option>
      </template>
    </select>

    <button x-show="hasActiveFilter" @click="resetFilters()" class="px-3 py-2 text-sm text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 underline">
      R√©initialiser
    </button>
  </div>


  <!-- Series cards -->
  <div class="grid gap-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
    <template x-for="s in filtered" :key="s.series">
      <a :href="s.seriesUrl" :title="s.title + ' - Niveau ' + s.level + ' - Difficult√© ' + s.difficulty" class="block p-3 bg-surface-subtle rounded-xl border border-slate-200 dark:border-slate-700 hover:border-primary-500 hover:shadow-md transition-all group">
        <div class="flex justify-between items-start gap-2 mb-1">
          <h2 class="text-sm font-extrabold text-content-default group-hover:text-primary-600 dark:group-hover:text-primary-400 leading-tight line-clamp-1" x-text="s.title"></h2>
          <span class="text-xs shrink-0" x-text="s.difficulty === 'difficile' ? 'üêû' : s.difficulty === 'moyen' ? 'üêù' : 'ü¶ó'"></span>
        </div>
        <div class="flex items-center gap-1.5 text-[11px] text-content-subtle">
          <span class="font-bold text-primary-600 dark:text-primary-400 uppercase shrink-0" x-text="s.level"></span>
          <span class="opacity-30 select-none">|</span>
          <span class="truncate" x-text="s.topic + (s.subtopic ? ' ‚Ä∫ ' + s.subtopic : '')"></span>
        </div>
      </a>
    </template>
  </div>

  <!-- Empty state -->
  <div x-show="filtered.length === 0" class="text-center py-12 text-content-subtle">
    Aucune s√©rie ne correspond aux filtres s√©lectionn√©s.
  </div>
</div>
